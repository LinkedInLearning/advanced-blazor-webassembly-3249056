@using MyBlazorShopHosted.Libraries.Shared.ShoppingCart.Models
@inject HttpClient httpClient
@inject NavigationManager navigationManager
<header id="banner">
	<a href="./"><img src="/images/logomark-big-star-white.svg" width="43" height="50" alt="Big Star Collectibles"></a>
    <NavMenu />
    <button type="button" @onclick="RedirectToCart">
		<img src="/images/icon-shopping-cart-v01-white.svg" width="36" height="33" alt="Cart Panel">
        <span class="visually-hidden">(</span><span class="num">@(ShoppingCartCountModel != null ? ShoppingCartCountModel.Count.ToString() : "0")</span> <span class="visually-hidden">items)</span>
	</button>
</header>
@code {
    [CascadingParameter(Name="ShoppingCartCountModel")]
    private ShoppingCartCountModel? ShoppingCartCountModel { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (ShoppingCartCountModel != null)
        {
            ShoppingCartCountModel.CountChange += async() =>
            {
                ShoppingCartCountModel.Count = await httpClient.GetFromJsonAsync<int>(
                    "/api/shopping-cart/count"
                );
                StateHasChanged();
            };
        }
        await base.OnInitializedAsync();
    }

    private void RedirectToCart()
    {
        navigationManager.NavigateTo("/cart");
    }
}